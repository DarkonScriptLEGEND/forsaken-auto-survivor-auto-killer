local Players = game:GetService("Players")
local Debris = game:GetService("Debris")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer

-- Teleport sound ID
local TELEPORT_SOUND_ID = "rbxassetid://9118820499"
local FOLLOW_PARTICLE_COLOR = Color3.fromRGB(255, 221, 51)

-- Create simple GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "TeleportFurthestGui"
ScreenGui.Parent = player:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 230, 0, 50)
mainFrame.Position = UDim2.new(0, 20, 0.4, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = ScreenGui

local teleportBtn = Instance.new("TextButton")
teleportBtn.Size = UDim2.new(1, -20, 1, -10)
teleportBtn.Position = UDim2.new(0, 10, 0, 5)
teleportBtn.BackgroundColor3 = Color3.fromRGB(255, 140, 0) -- Orange
teleportBtn.TextColor3 = Color3.new(1,1,1)
teleportBtn.Font = Enum.Font.SourceSansBold
teleportBtn.TextSize = 18
teleportBtn.Text = "Teleport To Furthest"
teleportBtn.Parent = mainFrame

-- Teleport sound helper
local function playTeleportSound(pos)
    local sound = Instance.new("Sound")
    sound.SoundId = TELEPORT_SOUND_ID
    sound.Volume = 0.75
    sound.PlayOnRemove = true
    sound.Parent = workspace
    sound.Position = pos or Vector3.new()
    sound:Destroy()
end

-- Particle effect helper
local function spawnParticles(position)
    local part = Instance.new("Part")
    part.Anchored = true
    part.CanCollide = false
    part.Transparency = 1
    part.Position = position
    part.Size = Vector3.new(1,1,1)
    part.Parent = workspace

    local particle = Instance.new("ParticleEmitter")
    particle.Texture = "rbxassetid://243660364" -- yellow spark
    particle.Color = ColorSequence.new(FOLLOW_PARTICLE_COLOR)
    particle.LightEmission = 1
    particle.Size = NumberSequence.new(1)
    particle.Rate = 100
    particle.Lifetime = NumberRange.new(0.5)
    particle.Speed = NumberRange.new(2, 4)
    particle.Parent = part

    Debris:AddItem(part, 1)
end

-- Find furthest safe position around player
local function findFurthestSafePosition()
    local character = player.Character
    if not character then return nil end
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil end
    local origin = hrp.Position

    local furthestPos = nil
    local maxDist = 0

    local function isSafe(pos)
        local ray = Ray.new(pos + Vector3.new(0,5,0), Vector3.new(0,-10,0))
        local hit, hitPos = workspace:FindPartOnRay(ray, character)
        if hit and hit.Transparency < 1 and hit.CanCollide then
            if hitPos.Y > 0 then
                local region = Region3.new(pos - Vector3.new(2,3,2), pos + Vector3.new(2,3,2))
                local parts = workspace:FindPartsInRegion3WithIgnoreList(region, {character}, 10)
                for _, p in pairs(parts) do
                    if p.CanCollide and p.Transparency < 1 then
                        return false
                    end
                end
                return true
            end
        end
        return false
    end

    local radius = 60
    local step = 10
    for angle = 0, 360, step do
        local radians = math.rad(angle)
        local testPos = origin + Vector3.new(math.cos(radians)*radius, 0, math.sin(radians)*radius)
        if isSafe(testPos) then
            local dist = (testPos - origin).Magnitude
            if dist > maxDist then
                maxDist = dist
                furthestPos = testPos
            end
        end
    end

    return furthestPos
end

-- Teleport player to a position with effects
local function teleportPlayerTo(pos)
    local character = player.Character
    if not character then return end
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local oldPos = hrp.Position
    spawnParticles(oldPos)
    hrp.CFrame = CFrame.new(pos + Vector3.new(0,3,0))
    spawnParticles(pos)
    playTeleportSound(pos)
end

-- Button click event
teleportBtn.MouseButton1Click:Connect(function()
    local pos = findFurthestSafePosition()
    if pos then
        teleportPlayerTo(pos)
    else
        warn("No safe location found to teleport!")
    end
end)
