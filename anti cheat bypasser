local LocalPlayer = game.Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Debris = game:GetService("Debris")

local Cooldown = false
local CooldownTime = 2.3
local TeleportOffset = Vector3.new(0, 7.5, -12)
local LastSafePosition = HumanoidRootPart.Position
local BehindYaEnabled = true

-- Custom teleport sound
local function playTeleportSound()
    local sound = Instance.new("Sound")
    sound.SoundId = "rbxassetid://9118823106" -- Replace with your custom teleport sound ID
    sound.Volume = 1
    sound.Parent = HumanoidRootPart
    sound:Play()
    Debris:AddItem(sound, 3)
end

-- Floating text
local function showFloatingText(text, color)
    local billboard = Instance.new("BillboardGui")
    billboard.Adornee = HumanoidRootPart
    billboard.Size = UDim2.new(0, 200, 0, 50)
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.AlwaysOnTop = true

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = color
    label.TextStrokeTransparency = 0
    label.Text = text
    label.Font = Enum.Font.GothamBlack
    label.TextScaled = true
    label.Parent = billboard

    billboard.Parent = HumanoidRootPart
    Debris:AddItem(billboard, 3)
end

-- Teleport to safe position
local function safeTeleport()
    if Cooldown then return end
    Cooldown = true

    local newPos = LastSafePosition + TeleportOffset
    HumanoidRootPart.CFrame = CFrame.new(newPos)
    playTeleportSound()
    showFloatingText("Successfully bypassed anti cheat", Color3.fromRGB(0, 255, 0))

    task.wait(CooldownTime)
    Cooldown = false
end

-- Check if stuck
local function isStuck()
    local rayOrigin = HumanoidRootPart.Position
    local rayDirection = Vector3.new(0, -5, 0)
    local raycast = workspace:Raycast(rayOrigin, rayDirection)
    return not raycast
end

-- Track position and handle escape
RunService.Heartbeat:Connect(function()
    if not BehindYaEnabled then return end

    local currentPos = HumanoidRootPart.Position
    local verticalSpeed = math.abs(HumanoidRootPart.Velocity.Y)

    if currentPos.Y < -20 then
        -- Under the map
        task.wait(0.93)
        safeTeleport()
    elseif isStuck() then
        -- Inside wall
        task.wait(0.75)
        safeTeleport()
    elseif verticalSpeed > 120 then
        -- Sudden vertical glitch
        task.wait(0.35)
        safeTeleport()
    else
        LastSafePosition = currentPos
    end
end)

-- Toggle on/off (optional keybind)
UIS.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.B then
        BehindYaEnabled = not BehindYaEnabled
        showFloatingText("Behind Ya: " .. (BehindYaEnabled and "ON" or "OFF"), Color3.fromRGB(255, 255, 255))
    end
end)
